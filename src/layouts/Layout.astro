---
import ThemeToggle from '../components/ThemeToggle.astro';

interface Props {
	title: string;
	description?: string;
	image?: string;
	type?: 'website' | 'article';
	canonicalURL?: string;
}

const {
	title,
	description = 'Explore prehistoric creatures and their fascinating world. Learn about dinosaurs, ancient life, and Earth\'s history through interactive timelines and detailed creature profiles.',
	image = '/images/hero-bg.jpg',
	type = 'website',
	canonicalURL = new URL(Astro.url.pathname, 'https://www.xinhao.eu').toString()
} = Astro.props;

// Ensure absolute URLs for images
const absoluteImageUrl = new URL(image, 'https://www.xinhao.eu').toString();
---

<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width" />

		<!-- Prevent flash of unstyled content for theme -->
		<script is:inline>
			(function() {
				const stored = localStorage.getItem('prehistory_theme');
				const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
				const theme = stored || (prefersDark ? 'dark' : 'light');
				document.documentElement.setAttribute('data-theme', theme);
			})();
		</script>
		
		<!-- Favicon -->
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<link rel="icon" type="image/x-icon" href="/favicon.ico" />
		<link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png" />
		<link rel="apple-touch-icon" href="/apple-touch-icon.png" />
		<link rel="manifest" href="/site.webmanifest" />
		<meta name="theme-color" content="#2c3e50" />

		<!-- Google Fonts: Nunito for a friendly, kid-appealing look -->
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">

		<meta name="generator" content={Astro.generator} />
		
		<!-- Primary Meta Tags -->
		<title>{title} | Prehistoric World</title>
		<meta name="title" content={`${title} | Prehistoric World`} />
		<meta name="description" content={description} />
		<meta name="author" content="Xinhao" />
		<meta name="keywords" content="prehistoric creatures, dinosaurs, fossils, paleontology, ancient life, evolution, Earth history, Jurassic period, Cretaceous period, Triassic period, prehistoric timeline, extinct animals, prehistoric world, ancient creatures, prehistoric facts" />
		
		<!-- Canonical URL -->
		<link rel="canonical" href={canonicalURL} />
		
		<!-- Open Graph / Facebook -->
		<meta property="og:type" content={type} />
		<meta property="og:url" content={canonicalURL} />
		<meta property="og:title" content={`${title} | Prehistoric World`} />
		<meta property="og:description" content={description} />
		<meta property="og:image" content={absoluteImageUrl} />
		<meta property="og:site_name" content="Prehistoric World" />
		<meta property="og:locale" content="en_US" />
		
		<!-- Twitter -->
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:url" content={canonicalURL} />
		<meta name="twitter:title" content={`${title} | Prehistoric World`} />
		<meta name="twitter:description" content={description} />
		<meta name="twitter:image" content={absoluteImageUrl} />
		<meta name="twitter:image:alt" content={title} />
		
		<!-- Additional SEO Tags -->
		<meta name="robots" content="index, follow, max-image-preview:large" />
		<meta name="language" content="English" />
		<meta name="revisit-after" content="7 days" />
		
		<!-- Structured Data -->
		<script type="application/ld+json" set:html={JSON.stringify({
			"@context": "https://schema.org",
			"@type": type === 'article' ? 'Article' : 'WebSite',
			"name": `${title} | Prehistoric World`,
			"description": description,
			"url": canonicalURL,
			"image": absoluteImageUrl,
			"author": {
				"@type": "Person",
				"name": "Xinhao",
				"description": "Young paleontology enthusiast",
				"url": "https://www.xinhao.eu/about"
			},
			"publisher": {
				"@type": "Organization",
				"name": "Prehistoric World",
				"logo": {
					"@type": "ImageObject",
					"url": "https://www.xinhao.eu/images/logo.png"
				}
			},
			"mainEntityOfPage": {
				"@type": "WebPage",
				"@id": canonicalURL
			},
			"about": {
				"@type": "Thing",
				"name": "Prehistoric Life",
				"description": "Information about prehistoric creatures, geological time periods, and Earth's history"
			},
			"audience": {
				"@type": "Audience",
				"audienceType": "Students, educators, and prehistoric life enthusiasts"
			},
			"keywords": "prehistoric creatures, dinosaurs, fossils, paleontology, ancient life, evolution"
		})} />
	</head>
	<body>
		<header class="main-header">
			<nav>
				<div class="logo">
					<a href="/">Prehistoric World</a>
				</div>
				<div class="nav-links">
					<a href="/">Home</a>
					<a href="/timeline">Timeline</a>
					<a href="/categories">Categories</a>
					<a href="/search">Search</a>
					<a href="/about">About</a>
				</div>
				<ThemeToggle />
			</nav>
		</header>
		<main>
			<slot />
		</main>
		<footer>
			<p>&copy; All Rights Reserved by Xinhao, 2026</p>
		</footer>
	</body>
</html>

<style is:global>
	:root {
		/* Clean, kid-friendly palette - Light Mode */
		--primary-color: #2c3e50;
		--secondary-color: #34495e;
		--accent-color: #e74c3c;
		--accent-hover: #c0392b;
		--background-color: #ecf0f1;
		--text-color: #2c3e50;
		--text-muted: #7f8c8d;
		--card-bg: #ffffff;
		--card-border: #e0e0e0;
		--header-bg: #2c3e50;
		--footer-bg: #2c3e50;
		--surface-elevated: #ffffff;
		--shadow-color: rgba(0, 0, 0, 0.1);

		/* Fun colors for kids */
		--fun-green: #27ae60;
		--fun-blue: #3498db;
		--fun-orange: #f39c12;
		--fun-purple: #9b59b6;

		/* Font */
		--font-main: 'Nunito', -apple-system, BlinkMacSystemFont, sans-serif;
	}

	/* Dark Mode - Volcanic/Cave atmosphere */
	[data-theme="dark"] {
		--primary-color: #e8e6e3;
		--secondary-color: #b8b5b1;
		--accent-color: #e74c3c;
		--accent-hover: #ff6b5b;
		--background-color: #1a1d23;
		--text-color: #e8e6e3;
		--text-muted: #9ca3af;
		--card-bg: #252830;
		--card-border: #3d4250;
		--header-bg: #12141a;
		--footer-bg: #12141a;
		--surface-elevated: #2d3139;
		--shadow-color: rgba(0, 0, 0, 0.3);

		/* Adjusted fun colors for dark mode */
		--fun-green: #34d399;
		--fun-blue: #60a5fa;
		--fun-orange: #fbbf24;
		--fun-purple: #a78bfa;
	}

	* {
		margin: 0;
		padding: 0;
		box-sizing: border-box;
	}

	html {
		font-family: var(--font-main);
		background: var(--background-color);
		color: var(--text-color);
		transition: background-color 0.3s ease, color 0.3s ease;
	}

	/* Smooth transitions for themed elements */
	html, body, header, footer, main, nav,
	.creature-card, .category-card, .timeline-card,
	h1, h2, h3, h4, h5, h6, a, p, span, div {
		transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
	}

	body {
		min-height: 100vh;
		display: flex;
		flex-direction: column;
	}

	h1, h2, h3, h4, h5, h6 {
		font-family: var(--font-main);
		font-weight: 700;
		color: var(--primary-color);
	}

	/* In dark mode, headings should use accent or lighter color */
	[data-theme="dark"] h1,
	[data-theme="dark"] h2,
	[data-theme="dark"] h3,
	[data-theme="dark"] h4,
	[data-theme="dark"] h5,
	[data-theme="dark"] h6 {
		color: var(--text-color);
	}

	.main-header {
		background: var(--header-bg);
		padding: 1rem 2rem;
		color: white;
	}

	nav {
		max-width: 1200px;
		margin: 0 auto;
		display: flex;
		justify-content: space-between;
		align-items: center;
	}

	.logo a {
		font-size: 1.5rem;
		font-weight: 800;
		color: white;
		text-decoration: none;
	}

	.nav-links {
		display: flex;
		gap: 2rem;
	}

	.nav-links a {
		color: white;
		text-decoration: none;
		font-weight: 600;
		transition: color 0.2s ease;
	}

	.nav-links a:hover {
		color: var(--accent-color);
	}

	/* Focus states for accessibility */
	.nav-links a:focus-visible {
		outline: 2px solid var(--accent-color);
		outline-offset: 4px;
		border-radius: 2px;
	}

	main {
		flex: 1;
		max-width: 1200px;
		margin: 0 auto;
		padding: 2rem;
		width: 100%;
	}

	footer {
		background: var(--footer-bg);
		color: white;
		text-align: center;
		padding: 1rem;
		margin-top: auto;
	}

	/* Global link styling */
	a {
		color: var(--accent-color);
		transition: color 0.2s ease;
	}

	a:hover {
		color: var(--accent-hover);
	}

	a:focus-visible {
		outline: 2px solid var(--accent-color);
		outline-offset: 2px;
		border-radius: 2px;
	}

	/* Buttons focus state */
	button:focus-visible {
		outline: 2px solid var(--accent-color);
		outline-offset: 2px;
	}

	@media (max-width: 768px) {
		nav {
			flex-direction: column;
			gap: 1rem;
		}

		.nav-links {
			flex-direction: column;
			align-items: center;
			gap: 1rem;
		}

		.nav-links a {
			font-size: 1.1rem;
		}
	}

	/* Global dark mode overrides for common patterns */
	[data-theme="dark"] .creature-card,
	[data-theme="dark"] .category-card,
	[data-theme="dark"] .period-card,
	[data-theme="dark"] .timeline-card,
	[data-theme="dark"] .search-card,
	[data-theme="dark"] .fact-card,
	[data-theme="dark"] .info-card,
	[data-theme="dark"] .detailed-description,
	[data-theme="dark"] .no-creatures,
	[data-theme="dark"] .content-section,
	[data-theme="dark"] .stats-section,
	[data-theme="dark"] .result-card,
	[data-theme="dark"] .search-result,
	[data-theme="dark"] .comment-card,
	[data-theme="dark"] .about-card,
	[data-theme="dark"] .quick-facts,
	[data-theme="dark"] .creature-meta {
		background: var(--card-bg) !important;
		border-color: var(--card-border) !important;
	}

	[data-theme="dark"] .creature-info,
	[data-theme="dark"] .card-content,
	[data-theme="dark"] .info-section,
	[data-theme="dark"] .detail-section {
		background: var(--card-bg) !important;
	}

	/* Dark mode input styles */
	[data-theme="dark"] input,
	[data-theme="dark"] textarea,
	[data-theme="dark"] select {
		background: var(--surface-elevated) !important;
		color: var(--text-color) !important;
		border-color: var(--card-border) !important;
	}

	[data-theme="dark"] input::placeholder,
	[data-theme="dark"] textarea::placeholder {
		color: var(--text-muted) !important;
	}

	/* Dark mode for images container backgrounds */
	[data-theme="dark"] .creature-image,
	[data-theme="dark"] .card-image {
		background: var(--surface-elevated);
	}

	/* Respect reduced motion preference */
	@media (prefers-reduced-motion: reduce) {
		*, *::before, *::after {
			animation-duration: 0.01ms !important;
			animation-iteration-count: 1 !important;
			transition-duration: 0.01ms !important;
		}
	}
</style>